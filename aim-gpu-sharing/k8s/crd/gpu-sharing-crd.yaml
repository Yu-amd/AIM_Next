apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: inferenceservices.aim.amd.com
  labels:
    app: aim-gpu-sharing
    component: crd
spec:
  group: aim.amd.com
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                gpuSharing:
                  type: object
                  description: GPU sharing configuration for this inference service
                  properties:
                    enabled:
                      type: boolean
                      description: Enable GPU sharing for this service
                      default: false
                    partitionId:
                      type: integer
                      description: Specific partition ID to use (null for auto-assignment)
                      nullable: true
                    computeMode:
                      type: string
                      description: Compute partition mode (SPX, CPX)
                      enum: ["SPX", "CPX"]
                      default: "SPX"
                    memoryMode:
                      type: string
                      description: Memory partition mode (NPS1, NPS4)
                      enum: ["NPS1", "NPS4"]
                      default: "NPS1"
                    memoryLimitGB:
                      type: number
                      description: Memory limit in GB for this partition
                      minimum: 0
                    preferredPartition:
                      type: integer
                      description: Preferred partition ID (scheduler will try to use this)
                      nullable: true
                    qosPriority:
                      type: string
                      description: QoS priority level
                      enum: ["low", "medium", "high"]
                      default: "medium"
            status:
              type: object
              properties:
                partitionInfo:
                  type: object
                  properties:
                    partitionId:
                      type: integer
                      description: Assigned partition ID
                    computeMode:
                      type: string
                      description: Active compute mode
                    memoryMode:
                      type: string
                      description: Active memory mode
                    partitionSizeGB:
                      type: number
                      description: Partition size in GB
                    allocatedMemoryGB:
                      type: number
                      description: Allocated memory in GB
                    availableMemoryGB:
                      type: number
                      description: Available memory in GB
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
      subresources:
        status: {}
  scope: Namespaced
  names:
    plural: inferenceservices
    singular: inferenceservice
    kind: InferenceService
    shortNames:
      - isvc
      - aim-isvc

